<template>
    <v-data-table
      :headers="headers"
      item-key="id"
      :items="products"
      mobile-breakpoint="0"
      :no-data-text="noDataText"
      :no-results-text="noResultsText"
      :search="productSearch"
      show-select
      v-model="selected"
    >
      <template v-slot:[`item.name`]="{ item }">
        <router-link :to="{ name: 'Product', params: { id: item.id } }">
          {{ item.name }}
        </router-link>
      </template>
    </v-data-table>
</template>

<script>
import { products } from '@/data/products.js'
import { mapActions, mapState } from 'vuex'

export default {
  computed: {
    ...mapState(['productSearch', 'selectedProductIDs']),

    selected: {
      get: function () {
        return this.selectedProductIDs.map(id => ({ id }))
      },

      set: function (payload) {
        return this.toggleSelected(payload)
      }
    }
  },

  data: function () {
    return {
      headers: [{ text: 'НАЗВАНИЕ', value: 'name' }],
      noDataText: 'Нет данных',
      noResultsText: 'Ничего не найдено',
      products: this.productsArrayToObject()
    }
  },

  methods: {
    ...mapActions(['toggleSelected']),

    productsArrayToObject: () => products.map(product => ({
      id: product[0],
      name: product[1]
    }))
  }
}
</script>
